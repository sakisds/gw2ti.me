function copyToClipboard(s){window.clipboardData&&clipboardData.setData&&clipboardData.setData("text",s)}function CountdownTimer(target,hours,seconds){1==hours&&(this.hours=0),1==seconds&&(this.seconds=0),this.target=target,hours&&seconds?this.text="--:--:--":this.text="--:--"}function CountupTimer(target){this.target=target,this.text="--:--"}function RingArray(array){this.array=array,this.length=array.length}function getRawTime(h,m){return 60*h+m}function getTimeFromRaw(rawTime){return{h:Math.floor(rawTime/60),m:rawTime%60}}function makeTimeText(h,m,s){if(null!=h){var _h="";_h=h>9?h.toString():"0"+h.toString()}var _m="";if(_m=m>9?m.toString():"0"+m.toString(),null!=s){var _s="";_s=s>9?s.toString():"0"+s.toString()}var result="";return null!=h&&(result+=_h+":"),result+=_m,null!=s&&(result+=":"+_s),result}var app=angular.module("gw2-timer",["720kb.tooltips"]);app.config(function(tooltipsConfigProvider){tooltipsConfigProvider.options({size:"large",lazy:!0,showTrigger:"click",hideTrigger:"click",side:"bottom","try":!1})}),angular.module("gw2-timer").controller("LastBossesController",["schedule","$scope","$interval",function(schedule,$scope,$interval){function refresh(){$scope.bosses=schedule.getLastBosses(),$scope.bosses.forEach(function(boss){boss.timer=new CountupTimer(boss.rawTime)})}function tick(){var date=new Date;$scope.bosses.forEach(function(boss){1==boss.timer.tick(date)&&refresh()})}$scope.bosses=null,refresh(),tick(),$interval(tick,1e3)}]),angular.module("gw2-timer").controller("NextBossesController",["schedule","$scope","$interval",function(schedule,$scope,$interval){function refresh(){$scope.bosses=schedule.getNextBosses(),$scope.bosses.forEach(function(boss){boss.timer=new CountdownTimer(boss.rawTime,!1,!0)})}function tick(){var date=new Date;$scope.bosses.forEach(function(boss){1==boss.timer.tick(date)&&refresh()})}$scope.bosses=null,refresh(),tick(),$interval(tick,1e3)}]),angular.module("gw2-timer").controller("NextTimeListController",["schedule","bossInfo","$scope","$interval",function(schedule,bossInfo,$scope,$interval){function refresh(){$scope.bosses.forEach(function(boss){var event=schedule.getNextOfBoss(boss.name);boss.localTime=event.localTime,boss.timer=new CountdownTimer(event.rawTime,!0,!1)})}function tick(){$scope.bosses.forEach(function(boss){var date=new Date;1==boss.timer.tick(date)&&refresh()})}$scope.bosses=[];for(var boss in bossInfo)bossInfo.hasOwnProperty(boss)&&$scope.bosses.push({name:bossInfo[boss].name,timerText:"--:--:--"});$scope.bosses.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),refresh(),tick(),$interval(tick,2e4)}]),angular.module("gw2-timer").controller("UpcomingListController",["schedule","$scope","$interval",function(schedule,$scope,$interval){function refresh(){$scope.events=schedule.getUpcomingEvents(),$scope.events.forEach(function(event){event.timer=new CountdownTimer(event.rawTime,!0,!1)})}function tick(){var date=new Date;$scope.events.forEach(function(event){1==event.timer.tick(date)&&refresh()})}$scope.events=null,refresh(),tick(),$interval(tick,2e4)}]),CountdownTimer.prototype.tick=function(now){var rawNow=getRawTime(now.getUTCHours(),now.getUTCMinutes()),remainingRaw=this.target-rawNow;if(0>=remainingRaw)return!0;var remaining=getTimeFromRaw(remainingRaw);return null!=this.hours&&(this.hours=remaining.h),null!=this.seconds&&(this.seconds=59-now.getUTCSeconds()),this.text=makeTimeText(this.hours,remaining.m,this.seconds),!1},CountupTimer.prototype.tick=function(now){var rawNow=getRawTime(now.getUTCHours(),now.getUTCMinutes()),remainingRaw=rawNow-this.target;if(remainingRaw>=30)return!0;var remaining=getTimeFromRaw(remainingRaw);return this.text=makeTimeText(null,remaining.m,now.getUTCSeconds()),!1},RingArray.prototype.get=function(i){for(;i>this.length-1;)i-=this.length-1;return this.array[i]},RingArray.prototype.getMany=function(i,count){for(var result=[],x=0;count>x;x++)result.push(this.get(i+x));return result},angular.module("gw2-timer").constant("bossInfo",{tequatl:{name:"Tequatl the Sunless",map:"Sparkfly Fen",hardcore:!0,icon:"img/bosses/tequatl.png",mapImage:"img/maps/tequatl.png",waypoint:"[&BNABAAA=]"},taidha:{name:"Taidha Covington",map:"Bloodtide Coast",hardcore:!1,icon:"img/bosses/taidha.png",waypoint:"[&BKgBAAA=]"},svanir:{name:"The Frozen Maw",map:"Wayfarer Foothills",hardcore:!1,icon:"img/bosses/svanir.png",mapImage:"img/maps/svanir.png",waypoint:"[&BE4DAAA=]"},megadestroyer:{name:"Megadestroyer",map:"Mount Maelstrom",hardcore:!1,icon:"img/bosses/megadestroyer.png",mapImage:"img/maps/megadestroyer.png",waypoint:"[&BM0CAAA=]"},behemoth:{name:"Shadow Behemoth",map:"Queensdale",hardcore:!1,icon:"img/bosses/behemoth.png",mapImage:"img/maps/behemoth.png",waypoint:"[&BPwAAAA=]"},golem:{name:"Golem Mark II",map:"Mount Maelstrom",hardcore:!1,icon:"img/bosses/golem.png",mapImage:"img/maps/golem.png",waypoint:"[&BNQCAAA=]"},karka:{name:"Karka Queen",map:"Southsun Cove",hardcore:!0,icon:"img/bosses/karka.png",mapImage:"img/maps/karka.png",waypoint:"[&BNcGAAA=]"},elemental:{name:"Fire Elemental",map:"Metrica Province",hardcore:!1,icon:"img/bosses/elemental.png",mapImage:"img/maps/elemental.png",waypoint:"[&BEYAAAA=]"},shatterer:{name:"The Shatterer",map:"Blazeridge Steppes",hardcore:!1,icon:"img/bosses/shatterer.png",mapImage:"img/maps/shatterer.png",waypoint:"[&BE4DAAA=]"},wurm:{name:"Great Jungle Wurm",map:"Caledon Forest",hardcore:!1,icon:"img/bosses/wurm.png",mapImage:"img/maps/wurm.png",waypoint:"[&BEEFAAA=]"},tripleTrouble:{name:"Triple Trouble",map:"Bloodtide Coast",hardcore:!0,icon:"img/bosses/tripletrouble.png",mapImage:"img/maps/tripleTrouble.png",waypoint:"[&BKoBAAA=]"},jormag:{name:"Claw of Jormag",map:"Frostgorge Sound",hardcore:!1,icon:"img/bosses/jormag.png",mapImage:"img/maps/jormag.png",waypoint:"[&BNQCAAA=]"},modniir:{name:"Modniir Ulgoth",map:"Harathi Hinterlands",hardcore:!1,icon:"img/bosses/modniir.png",mapImage:"img/maps/modniir.png",waypoint:"[&BLEAAAA=]"}}),angular.module("gw2-timer").service("schedule",["bossInfo",function(bossInfo){function _createSimplifiedEvent(event,bossIndex){return{name:event.boss[bossIndex].name,map:event.boss[bossIndex].map,hardcore:event.boss[bossIndex].hardcore,icon:event.boss[bossIndex].icon,localtime:event.localTime,rawTime:event.rawTime,waypoint:event.boss[bossIndex].waypoint,mapImage:event.boss[bossIndex].mapImage}}this.events=new RingArray([{h:0,m:0,boss:[bossInfo.tequatl,bossInfo.taidha]},{h:0,m:15,boss:[bossInfo.svanir]},{h:0,m:30,boss:[bossInfo.megadestroyer]},{h:0,m:45,boss:[bossInfo.elemental]},{h:1,m:0,boss:[bossInfo.tripleTrouble,bossInfo.shatterer]},{h:1,m:15,boss:[bossInfo.wurm]},{h:1,m:30,boss:[bossInfo.modniir]},{h:1,m:45,boss:[bossInfo.behemoth]},{h:2,m:0,boss:[bossInfo.karka,bossInfo.golem]},{h:2,m:15,boss:[bossInfo.svanir]},{h:2,m:30,boss:[bossInfo.jormag]},{h:2,m:45,boss:[bossInfo.elemental]},{h:3,m:0,boss:[bossInfo.tequatl,bossInfo.taidha]},{h:3,m:15,boss:[bossInfo.wurm]},{h:3,m:30,boss:[bossInfo.megadestroyer]},{h:3,m:45,boss:[bossInfo.behemoth]},{h:4,m:0,boss:[bossInfo.tripleTrouble,bossInfo.shatterer]},{h:4,m:15,boss:[bossInfo.svanir]},{h:4,m:30,boss:[bossInfo.modniir]},{h:4,m:45,boss:[bossInfo.elemental]},{h:5,m:0,boss:[bossInfo.golem]},{h:5,m:15,boss:[bossInfo.wurm]},{h:5,m:30,boss:[bossInfo.jormag]},{h:5,m:45,boss:[bossInfo.behemoth]},{h:6,m:0,boss:[bossInfo.karka,bossInfo.taidha]},{h:6,m:15,boss:[bossInfo.svanir]},{h:6,m:30,boss:[bossInfo.megadestroyer]},{h:6,m:45,boss:[bossInfo.elemental]},{h:7,m:0,boss:[bossInfo.tequatl,bossInfo.shatterer]},{h:7,m:15,boss:[bossInfo.wurm]},{h:7,m:30,boss:[bossInfo.modniir]},{h:7,m:45,boss:[bossInfo.behemoth]},{h:8,m:0,boss:[bossInfo.tripleTrouble,bossInfo.golem]},{h:8,m:15,boss:[bossInfo.svanir]},{h:8,m:30,boss:[bossInfo.jormag]},{h:8,m:45,boss:[bossInfo.elemental]},{h:9,m:0,boss:[bossInfo.taidha]},{h:9,m:15,boss:[bossInfo.wurm]},{h:9,m:30,boss:[bossInfo.megadestroyer]},{h:9,m:45,boss:[bossInfo.behemoth]},{h:10,m:0,boss:[bossInfo.shatterer]},{h:10,m:15,boss:[bossInfo.svanir]},{h:10,m:30,boss:[bossInfo.karka,bossInfo.modniir]},{h:10,m:45,boss:[bossInfo.elemental]},{h:11,m:0,boss:[bossInfo.golem]},{h:11,m:15,boss:[bossInfo.wurm]},{h:11,m:30,boss:[bossInfo.tequatl,bossInfo.jormag]},{h:11,m:45,boss:[bossInfo.behemoth]},{h:12,m:0,boss:[bossInfo.taidha]},{h:12,m:15,boss:[bossInfo.svanir]},{h:12,m:30,boss:[bossInfo.tripleTrouble,bossInfo.megadestroyer]},{h:12,m:45,boss:[bossInfo.elemental]},{h:13,m:0,boss:[bossInfo.shatterer]},{h:13,m:15,boss:[bossInfo.wurm]},{h:13,m:30,boss:[bossInfo.modniir]},{h:13,m:45,boss:[bossInfo.behemoth]},{h:14,m:0,boss:[bossInfo.golem]},{h:14,m:15,boss:[bossInfo.svanir]},{h:14,m:30,boss:[bossInfo.jormag]},{h:14,m:45,boss:[bossInfo.elemental]},{h:15,m:0,boss:[bossInfo.karka,bossInfo.taidha]},{h:15,m:15,boss:[bossInfo.wurm]},{h:15,m:30,boss:[bossInfo.megadestroyer]},{h:15,m:45,boss:[bossInfo.behemoth]},{h:16,m:0,boss:[bossInfo.tequatl,bossInfo.shatterer]},{h:16,m:15,boss:[bossInfo.svanir]},{h:16,m:30,boss:[bossInfo.modniir]},{h:16,m:45,boss:[bossInfo.elemental]},{h:17,m:0,boss:[bossInfo.tripleTrouble,bossInfo.golem]},{h:17,m:15,boss:[bossInfo.wurm]},{h:17,m:30,boss:[bossInfo.jormag]},{h:17,m:45,boss:[bossInfo.behemoth]},{h:18,m:0,boss:[bossInfo.karka,bossInfo.taidha]},{h:18,m:15,boss:[bossInfo.svanir]},{h:18,m:30,boss:[bossInfo.megadestroyer]},{h:18,m:45,boss:[bossInfo.elemental]},{h:19,m:0,boss:[bossInfo.tequatl,bossInfo.shatterer]},{h:19,m:15,boss:[bossInfo.wurm]},{h:19,m:30,boss:[bossInfo.modniir]},{h:19,m:45,boss:[bossInfo.behemoth]},{h:20,m:0,boss:[bossInfo.tripleTrouble,bossInfo.golem]},{h:20,m:15,boss:[bossInfo.svanir]},{h:20,m:30,boss:[bossInfo.jormag]},{h:20,m:45,boss:[bossInfo.elemental]},{h:21,m:0,boss:[bossInfo.taidha]},{h:21,m:15,boss:[bossInfo.wurm]},{h:21,m:30,boss:[bossInfo.megadestroyer]},{h:21,m:45,boss:[bossInfo.behemoth]},{h:22,m:0,boss:[bossInfo.shatterer]},{h:22,m:15,boss:[bossInfo.svanir]},{h:22,m:30,boss:[bossInfo.modniir]},{h:22,m:45,boss:[bossInfo.elemental]},{h:23,m:0,boss:[bossInfo.karka,bossInfo.golem]},{h:23,m:15,boss:[bossInfo.wurm]},{h:23,m:30,boss:[bossInfo.jormag]},{h:23,m:45,boss:[bossInfo.behemoth]}]),this.events.array.forEach(function(event){event.rawTime=getRawTime(event.h,event.m);var rawTimeWithOffset=event.rawTime-(new Date).getTimezoneOffset();rawTimeWithOffset>=1440&&(rawTimeWithOffset-=1440);var localTime=getTimeFromRaw(rawTimeWithOffset);event.localTime=makeTimeText(localTime.h,localTime.m,null)}),this.getNextBosses=function(){var date=new Date,h=date.getUTCHours(),m=date.getUTCMinutes();if(23==h&&m>45)return[_createSimplifiedEvent(events.get(0),0),_createSimplifiedEvent(events.get(0),1)];for(var event,rawTime=getRawTime(h,m),i=0;i<this.events.length+1;i++)if(event=this.events.get(i),event.rawTime>rawTime)return 2==event.boss.length?[_createSimplifiedEvent(this.events.get(i),0),_createSimplifiedEvent(this.events.get(i),1)]:[_createSimplifiedEvent(this.events.get(i),0),_createSimplifiedEvent(this.events.get(i+1),0)]},this.getLastBosses=function(){var date=new Date,h=date.getUTCHours(),m=date.getUTCMinutes(),rawTime=getRawTime(h,m);if(23==h&&m>45)return[_createSimplifiedEvent(this.events.get(this.events.length-1),0),_createSimplifiedEvent(this.events.get(this.events.length-2),1)];for(var i=0;i<this.events.length;i++)if(this.events.get(i).rawTime>rawTime)return 0==i?[_createSimplifiedEvent(this.events.get(this.events.length-1),0),_createSimplifiedEvent(this.events.get(this.events.length-2),1)]:1==i?[_createSimplifiedEvent(this.events.get(0),0),_createSimplifiedEvent(this.events.get(0),1)]:2==this.events.get(i-1).boss.length?[_createSimplifiedEvent(this.events.get(i-1),0),_createSimplifiedEvent(this.events.get(i-1),1)]:[_createSimplifiedEvent(this.events.get(i-1),0),_createSimplifiedEvent(this.events.get(i-2),0)]},this.getUpcomingEvents=function(){var date=new Date,h=date.getUTCHours(),m=date.getUTCMinutes(),rawTime=getRawTime(h,m);if(23==h&&m>45)return this.events.getMany(0,13);for(var event,i=0;i<this.events.length;i++)if(event=this.events.get(i),event.rawTime>rawTime)return 1==event.boss.length?this.events.getMany(i+2,13):this.events.getMany(i+1,13)},this.getNextOfBoss=function(name){for(var date=new Date,h=date.getUTCHours(),m=date.getUTCMinutes(),rawTime=getRawTime(h,m),i=0;i<this.events.length;i++){var event=this.events.get(i),nameCheck=!1;if(event.boss.forEach(function(eventBoss){eventBoss.name===name&&(nameCheck=!0)}),nameCheck&&event.rawTime>=rawTime)return event;i==this.events.length-1&&(rawTime=0,i=-1)}}}]);
